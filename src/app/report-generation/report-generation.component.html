<form [formGroup]="dateRangeForm" (ngSubmit)="onSubmit()" class="report-form">
<!-- New Report dropdown list -->
<mat-form-field appearance="outline" class="report-category-field">
  <mat-label>Report</mat-label>
  <mat-select formControlName="reportCategory">
    <mat-option *ngFor="let category of reportCategoryOptions" [value]="category.value">
      {{ category.label }}
    </mat-option>
  </mat-select>
</mat-form-field>

  <div class="date-range-container">
    <mat-form-field appearance="outline" class="date-picker-field">
      <mat-label>Start Date</mat-label>
      <input matInput [matDatepicker]="startPicker" formControlName="startDate" />
      <mat-datepicker-toggle matSuffix [for]="startPicker"></mat-datepicker-toggle>
      <mat-datepicker #startPicker></mat-datepicker>
      <mat-error *ngIf="dateRangeForm.get('startDate')?.hasError('required')">
        Start date is required
      </mat-error>
    </mat-form-field>

    <mat-form-field appearance="outline" class="date-picker-field">
      <mat-label>End Date</mat-label>
      <input matInput [matDatepicker]="endPicker" formControlName="endDate"
        [min]="dateRangeForm.get('startDate')?.value" />
      <mat-datepicker-toggle matSuffix [for]="endPicker"></mat-datepicker-toggle>
      <mat-datepicker #endPicker></mat-datepicker>
      <mat-error *ngIf="dateRangeForm.get('endDate')?.hasError('required')">
        End date is required
      </mat-error>
      <mat-error *ngIf="dateRangeForm.hasError('endBeforeStart')">
        End date must be after start date
      </mat-error>
    </mat-form-field>

    <!-- Dropdown list for report type -->
    <mat-form-field appearance="outline" class="report-type-field">
      <mat-label>Report Type</mat-label>
      <mat-select formControlName="reportType">
        <mat-option *ngFor="let option of reportTypeOptions" [value]="option.value">
          {{ option.label }}
        </mat-option>
      </mat-select>
    </mat-form-field>
  </div>

  <div class="form-actions">
    <button mat-raised-button color="primary" type="submit" [disabled]="!dateRangeForm.valid || loading()">
      <span *ngIf="!loading()">Generate Report</span>
      <mat-spinner diameter="20" *ngIf="loading()"></mat-spinner>
    </button>

    <mat-error *ngIf="error()" class="error-message">
      {{ error() }}
    </mat-error>
  </div>
</form>

<div class="report-summaries">
  <div class="header-row">
    <h3>Generated Reports</h3>
  </div>

  <mat-error *ngIf="summariesError()">{{ summariesError() }}</mat-error>

  <div *ngIf="summariesLoading()" class="loading-wrap">
    <mat-progress-spinner mode="indeterminate"></mat-progress-spinner>
  </div>

  <table mat-table [dataSource]="summaries() || []" class="mat-elevation-z2 full-width">

    <!-- Report Type -->
    <ng-container matColumnDef="reportType">
      <th mat-header-cell *matHeaderCellDef> Type </th>
      <td mat-cell *matCellDef="let r"> {{ r.reportType }} </td>
    </ng-container>

    <!-- File Name -->
    <ng-container matColumnDef="fileName">
      <th mat-header-cell *matHeaderCellDef> File </th>
      <td mat-cell *matCellDef="let r"> {{ r.fileName }} </td>
    </ng-container>

    <!-- Start -->
    <ng-container matColumnDef="start">
      <th mat-header-cell *matHeaderCellDef> Start </th>
      <td mat-cell *matCellDef="let r"> {{ r.startDateTime | date:'short' }} </td>
    </ng-container>

    <!-- End -->
    <ng-container matColumnDef="end">
      <th mat-header-cell *matHeaderCellDef> End </th>
      <td mat-cell *matCellDef="let r"> {{ r.endDateTime | date:'short' }} </td>
    </ng-container>

    <!-- Created -->
    <ng-container matColumnDef="createdAt">
      <th mat-header-cell *matHeaderCellDef> Created </th>
      <td mat-cell *matCellDef="let r"> {{ r.createdAt | date:'short' }} </td>
    </ng-container>

    <!-- Actions -->
    <ng-container matColumnDef="actions">
      <th mat-header-cell *matHeaderCellDef> Actions </th>
      <td mat-cell *matCellDef="let r">
        <button mat-raised-button color="primary" (click)="download(r.id)">
          <mat-icon>download</mat-icon>
          Download
        </button>
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="['reportType','fileName','start','end','createdAt','actions']"></tr>
    <tr mat-row *matRowDef="let row; columns: ['reportType','fileName','start','end','createdAt','actions'];"></tr>
  </table>

  <div *ngIf="(summaries()?.length || 0) === 0 && !summariesLoading()" class="empty-state">
    No generated reports yet.
  </div>
</div>

<div *ngIf="inventoryTransactions()" class="report-status">
  <mat-icon class="success-icon">check_circle</mat-icon>
  <span>Report generated successfully for
    {{ inventoryTransactions()?.length }} transactions</span>
</div>
